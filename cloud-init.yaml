#cloud-config
users:
  - name: scap_auditor
    groups: sudo
    shell: /bin/bash
    lock_passwd: true
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_authorized_keys: 
    - ssh-rsa AAAAB3N...
    
package_update: true
package_upgrade: true    
packages:
  - unzip
  - libopenscap8
  - ssg-debderived

runcmd:
  - cd /usr/share/xml/scap/ssg/content
  - wget https://github.com/ComplianceAsCode/content/releases/download/v0.1.69/scap-security-guide-0.1.69.zip
  - unzip scap-security-guide-0.1.69.zip
  - cd scap-security-guide-0.1.69/
  - oscap xccdf eval --profile xccdf_org.ssgproject.content_profile_stig --report report.html ssg-ubuntu2004-ds-1.2.xml

# Secure copy results file from remote to local
# scp ubuntu@10.1.29.82:/usr/share/xml/scap/ssg/content/scap-security-guide-0.1.69/report.html ~/Development
